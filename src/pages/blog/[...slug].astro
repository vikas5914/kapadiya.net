---
import { type CollectionEntry, getCollection } from "astro:content";
import BlogLayout from "../../layouts/BlogLayout.astro";
import { metaData } from "../../config";

import CustomMdx from "@components/Mdx.astro";

const { url, site } = Astro;

const { slug } = Astro.params;

if (slug === undefined) {
  return Astro.redirect("/404");
}

export async function getStaticPaths() {
  const posts = await getCollection("posts");
  return posts.map((post) => ({
    params: { slug: post.id },
    props: post,
  }));
}

type Props = CollectionEntry<"posts">;

const post = Astro.props;
// 3. Redirect if the entry does not exist
if (post === undefined) {
  return Astro.redirect("/404");
}
---

<BlogLayout
  title={post.data.title}
  description={post.data.description}
  author={post.data.author}
  date={post.data.date}
  readTime={post.data.readTime}
  category={post.data.category}
  featured={post.data.featured}
  slug={post.data.slug}
  cover={post.data.cover}
  excerpt={post.data.excerpt}
  ><section>
    <script
      type="application/ld+json"
      set:html={JSON.stringify({
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        headline: post.data.title,
        datePublished: post.data.date,
        dateModified: post.data.date,
        description: post.data.excerpt,
        image: url.href,
        url: url,
        author: {
          "@type": "Person",
          name: metaData.name,
        },
      })}
    />
    <CustomMdx content={post.body} />
  </section>
</BlogLayout>
